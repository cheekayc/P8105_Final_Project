---
title: "Tests & Analyses"
output: github_document
date: "2022-12-05"
---

```{r setup}
knitr::opts_chunk$set(message = FALSE)

library(tidyverse)
library(lubridate)
library(plotly)
library(mgcv)
```

Data input and cleaning 
```{r}
bakery_df =
  read_csv("./Data/Bakery_sales.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    unit_price = str_replace(unit_price, "â‚¬", ""),
    unit_price = str_replace(unit_price, ",", "."),
    unit_price = as.numeric(unit_price),
    product_name = article) %>% 
  filter(product_name != ".") %>% 
  select(-article)

bakery_df
```

### ANOVA

ANOVA tests whether there is a difference in means of the groups at each level (each individual month) of the independent variable.

One way anova test can test if the mean sales of quarter 1 (Jan - Mar) is different from the mean sales of quarter 3 (Jun - Aug).

The null hypothesis is that there is no difference in the mean sales of 1st quarter and 3rd quarter.                                        
The alternative hypothesis is that the means are different from one another.

```{r ANOVA}
anova_df =
  bakery_df %>% 
  mutate(
    year = year(date),
    month = month(date),
    rev = quantity * unit_price) 

third_sales = 
  anova_df %>% 
  filter((month == 6)|(month == 7)|(month == 8)) %>% 
  group_by(year, month) %>% 
  summarize(third_sales = n()) %>% 
  group_by(year, month) %>% 
  mutate(ID = cur_group_id())
  
first_sales = 
  anova_df %>% 
  filter((month == 1) |(month == 2)|(month == 3)) %>% 
  group_by(year, month) %>% 
  summarize(first_sales = n()) %>% 
  group_by(year, month) %>% 
  mutate(ID = cur_group_id())
  
anova_test_df = 
  left_join(third_sales, first_sales, by = c("ID"))

anova_test_df

one.way <- aov(first_sales ~ third_sales, data = anova_test_df)

summary(one.way)
```
The ANOVA test p-value is 0.00451 which is less than alpha level of 0.05, so we reject the null hypothesis and conclude that the mean sales in quarter 1 is statistically significantly different from the mean sales of quarter 3.


### Linear Regression

We are interested in testing the relationship between the unit price of a product and its quantity being sold. Considering that 
the sales of bakery varies by month, so we included `month` in our model as a confounder to be controlled.

Linear Regression for baguette 
```{r}
baguette_df = 
  bakery_df %>% 
  filter(str_detect(product_name, "BAGUETTE")) %>% 
  mutate(
    month = month(date))

baguette_reg = lm(quantity ~ unit_price + month, baguette_df)

baguette_reg %>% 
  broom::tidy()
```

Linear Regression for croissant
```{r}
croissant_df = 
  bakery_df %>% 
  filter(str_detect(product_name, "CROISSANT")) %>% 
  mutate(
    month = month(date))

croissant_reg = lm(quantity ~ unit_price + month, croissant_df)

croissant_reg %>% 
  broom::tidy()
```

### One-sample T-test

##### Regular Baguette (Two-sided)

We are interested in testing if the mean price of **regular baguette** in this bakery is significantly different from 
the average price for a baguette in Paris, which is 1.07 euros. 

Null hypothesis: The mean price of baguette in this bakery is the same as the average price of baguette in Paris.

Alternative hypothesis: The mean price of baguette in this bakery is different from the average price of baguette in Paris.

```{r}
baguette_onet = 
  bakery_df %>% 
  filter(product_name == "BAGUETTE") %>%
  select(unit_price)

baguette_t_results = 
  t.test(baguette_onet, mu = 1.07 , alternative = "two.sided") %>% 
  broom::tidy()
```

The p-value is much smaller than the alpha (0.05), so we would reject the null hypothesis. At 5% level of significance, we have sufficient 
evidence to conclude that the mean price of baguette in this bakery is significantly different from the average price of baguette in Paris.


##### Traditional Baguette (One-sided)

We noticed that the price of traditional baguette in this bakery is higher than the average price of traditional baguette in France. The
price of the traditional French loaf is around 0.90 Euros in bakeries. Therefore, we would like to conduct a one-sided T-test to see if the price difference is significant. 

Null hypothesis: The mean price of traditional baguette in this bakery is the same as the average price of traditional baguette in France.

Alternative hypothesis: The mean price of traditional baguette in this bakery is higher than the average price of traditional baguette in
France.

```{r}
bakery_df %>% 
  filter(product_name == "TRADITIONAL BAGUETTE") %>% 
  count(unit_price)
  
trad_baguette_onet = 
  bakery_df %>% 
  filter(product_name == "TRADITIONAL BAGUETTE") %>%
  select(unit_price)

trad_baguette_t_results = 
  t.test(trad_baguette_onet, mu = 0.90, alternative = "greater") %>% 
  broom::tidy()
```

The p-value is much smaller than the alpha (0.05), so we would reject the null hypothesis. At 5% level of significance, we have sufficient 
evidence to conclude that the mean price of traditional baguette in this bakery is significantly higher than the average price of baguette 
in Paris.


### Generalized Additive Model 

Find the *rush hours* of a typical day:
```{r}
bakery_df = 
  bakery_df %>% 
  mutate(
    Hour = hour(time))

bakery_df %>% 
  group_by(Hour) %>% 
  count() %>% 
  ggplot(aes(x = Hour, y = n)) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = seq(7, 20), limit = c(7, 20)) +
  scale_y_continuous(limit = c(0,50000)) +
  labs(
    title = "Peak hours",
    x = "Hour (24-hour format)",
    y = "Number of times appeared")
```

Overall, what hours has the most number of products sold?
```{r}
bakery_df %>% 
  group_by(Hour) %>% 
  summarize(
    n_sold = sum(quantity))
```

```{r}
smooth_mod = gam(quantity ~ s(Hour), data = bakery_df)

smooth_mod %>% broom::tidy()
```

